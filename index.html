<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciativas Aprobadas 2024</title>
    <style>
        :root {
            --color-fondo: #f0f4f8;
            --color-primario: #003366;
            --color-secundario: #ffffff;
            --color-texto: #ffffff;
            --color-texto-general: #333333;
            --color-borde: #cccccc;
            --color-hover: #e6f0fa;
            --color-header: #002244;
            --color-boton: #003366;
            --color-boton-texto: #ffffff;
            --color-finalizada: #d1e7dd;
            --color-en-desarrollo: #fff3cd;
            --color-no-iniciada: #f8d7da;
            --color-descartada: #d1ecf1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-fondo);
            margin: 0;
            padding: 20px;
            color: var(--color-texto-general);
        }

        .encabezado {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-header);
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
        }

        .encabezado h1 {
            color: var(--color-texto);
            font-size: 2em;
            margin: 0;
            text-align: center;
            width: 100%;
        }

        .encabezado img {
            height: 60px;
            position: absolute;
            right: 20px;
        }

        .filtros {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center;
            background-color: var(--color-header);
            padding: 10px 20px;
            border-radius: 8px;
        }

        .filtros div {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        label {
            font-weight: bold;
            color: var(--color-texto);
        }

        select {
            padding: 5px 10px;
            border: 1px solid var(--color-borde);
            border-radius: 4px;
            background-color: var(--color-secundario);
            transition: border 0.3s;
            color: var(--color-texto-general);
        }

        select:focus {
            border-color: var(--color-primario);
            outline: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: var(--color-secundario);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        th, td {
            border: 1px solid var(--color-borde);
            padding: 12px 15px;
            text-align: left;
            transition: background-color 0.3s;
            position: relative;
        }

        th {
            background-color: var(--color-header);
            color: var(--color-texto);
            position: sticky;
            top: 0;
            z-index: 2;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background-color: #e6f0fa;
        }

        tr:hover {
            background-color: var(--color-hover);
        }

        tr.finalizada {
            background-color: var(--color-finalizada) !important;
        }

        tr.en-desarrollo {
            background-color: var(--color-en-desarrollo) !important;
        }

        tr.no-iniciada {
            background-color: var(--color-no-iniciada) !important;
        }

        tr.descartada {
            background-color: var(--color-descartada) !important;
        }

        input[type="text"], select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--color-borde);
            border-radius: 4px;
            box-sizing: border-box;
            transition: border 0.3s;
            background-color: var(--color-secundario);
            color: var(--color-texto-general);
            resize: vertical;
        }

        input[type="text"]:focus, select:focus, textarea:focus {
            border-color: var(--color-primario);
            outline: none;
        }

        textarea.expandable-textarea {
            min-height: 60px;
            overflow: hidden;
            transition: min-height 0.3s;
        }

        textarea.expandable-textarea:focus {
            min-height: 120px;
        }

        .btn-agregar, .btn-exportar {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
            gap: 10px;
        }

        .btn-agregar button, .btn-exportar button {
            background-color: var(--color-boton);
            color: var(--color-boton-texto);
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .btn-agregar button:hover, .btn-exportar button:hover {
            background-color: #002244;
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            th, td {
                padding: 8px 10px;
            }

            .btn-agregar, .btn-exportar {
                flex-direction: column;
                align-items: center;
            }

            .btn-agregar button, .btn-exportar button {
                width: 100%;
            }

            .filtros {
                flex-direction: column;
                align-items: center;
            }

            .encabezado {
                flex-direction: column;
                align-items: center;
            }

            .encabezado img {
                position: static;
                margin: 10px 0 0 0;
            }

            .encabezado h1 {
                text-align: center;
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--color-secundario);
            margin: 10% auto;
            padding: 20px;
            border: 1px solid var(--color-borde);
            width: 80%;
            border-radius: 8px;
            position: relative;
        }

        .close {
            color: var(--color-texto-general);
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: var(--color-primario);
            text-decoration: none;
            cursor: pointer;
        }

        .modal textarea, .modal input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            margin-bottom: 20px;
            border: 1px solid var(--color-borde);
            border-radius: 4px;
            resize: vertical;
            color: var(--color-texto-general);
        }

        .modal button {
            background-color: var(--color-primario);
            color: var(--color-boton-texto);
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .modal button:hover {
            background-color: #002244;
        }
    </style>
</head>
<body>
    <!-- Encabezado con T칤tulo Centrado y Logo a la Derecha -->
    <div class="encabezado">
        <h1>Iniciativas Aprobadas 2024</h1>
        <img src="blatorh.png" alt="Logo de Blatorh">
    </div>

    <!-- Secci칩n de Filtros con Fondo Azul Oscuro y Texto Blanco -->
    <div class="filtros">
        <div>
            <label for="filtro-responsable">Filtrar por Responsable:</label>
            <select id="filtro-responsable">
                <option value="Todos">Todos</option>
            </select>
        </div>
        
        <div>
            <label for="filtro-estado">Filtrar por Estado:</label>
            <select id="filtro-estado">
                <option value="Todos">Todos</option>
            </select>
        </div>
    </div>
    
    <!-- Tabla de Iniciativas -->
    <table>
        <thead>
            <tr>
                <th style="width: 35%">Iniciativas Aprobadas</th>
                <th style="width: 20%">Responsables</th>
                <th style="width: 20%">Estado de la Iniciativa</th>
                <th style="width: 20%">Comentarios</th>
            </tr>
        </thead>
        <tbody id="tabla-cuerpo">
            <!-- Filas de la tabla ser치n generadas din치micamente -->
        </tbody>
    </table>

    <!-- Botones para Descargar a Excel y Agregar Nueva Iniciativa -->
    <div class="btn-agregar btn-exportar">
        <button id="btn-exportar">游닌 Descargar a Excel</button>
        <button id="btn-agregar">+ Agregar Iniciativa</button>
    </div>

    <!-- Modal para Editar Iniciativas y Comentarios -->
    <div id="miModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modal-titulo">Editar</h2>
            <input type="text" id="modal-input" />
            <textarea id="modal-textarea" rows="4"></textarea>
            <button id="guardar-cambio">Guardar</button>
        </div>
    </div>

    <script>
        // Datos Iniciales de las Iniciativas
        let iniciativas = [
            { nombre: "Generar un set de reportes en nuestra base de SF Demo con la herramienta de People Analityc para luego ser ofrecido a los distintos clientes", responsable: "Anthony Rivero", estado: "No iniciada", comentarios: "" },
            { nombre: "Luego de la implementaci칩n de la herramienta en el cliente Roemmers analizar si es viable y recomendable ofrecerlo a otros clientes.", responsable: "Anthony Rivero", estado: "No iniciada", comentarios: "" },
            { nombre: "Desarrollar nuevas funcionalidades avanzadas de gesti칩n de datos maestros en la plataforma SAP SuccessFactors. Ejemplo desarrollos en BTP, clonador de legajos en EC,Carga masiva de datos en EC.", responsable: "Ariel Di Prinzio", estado: "No iniciada", comentarios: "" },
            { nombre: "Generar para poder implementar Payroll Control Center en distintos clientes teniendo como base el RDS ofrecido por SAP y viendo el funcionamiento en la implementaci칩n actual en Ford", responsable: "Pablo Bascoy", estado: "No iniciada", comentarios: "" },
            { nombre: "Elecci칩n de la herramienta, propuesta de procesos e implementaci칩n para mejorar las oportunidades, relaci칩n con los clientes y mejorar las ventas", responsable: "Pablo Bascoy", estado: "No iniciada", comentarios: "" },
            { nombre: "Generar blogs, art칤culos, infograf칤as y videos de calidad para la p치gina web de BlatoRH. Los usuarios deber치n registrarse para acceder a este contenido, lo que nos permitir치 generar nuevos contactos.", responsable: "Francisco Torres", estado: "No iniciada", comentarios: "" },
            { nombre: "Aumentar la interacci칩n y visibilidad de BlatoRH en redes sociales clave como LinkedIn, Instagram y Facebook. Compartir proyectos finalizados con 칠xito para dar a conocer nuestros servicios.", responsable: "Francisco Torres", estado: "No iniciada", comentarios: "" },
            { nombre: "Desarrollo de un brochure corporativo que presente de manera detallada y atractiva los servicios ofrecidos por nuestra firma.", responsable: "Leonardo Blau", estado: "No iniciada", comentarios: "" },
            { nombre: "Desarrollo de documentos con preguntas clave por m칩dulo, para poder comprender mejor las necesidades del cliente y armar propuestas a la medida.", responsable: "Gabriela Gimenez", estado: "No iniciada", comentarios: "" },
            { nombre: "Creaci칩n de un documento que resuma la funcionalidad est치ndar de los m칩dulos, para poder presentarlo r치pidamente a clientes y prospectos.", responsable: "Gabriela Gimenez", estado: "No iniciada", comentarios: "" },
            { nombre: "Comunicaci칩n del programa de incentivos para nuestro equipo, con el objetivo de motivar y recompensar la generaci칩n de nuevas oportunidades con nuevos clientes que generen ingresos.", responsable: "Leonardo Blau", estado: "No iniciada", comentarios: "" },
            { nombre: "Propuesta de un programa de capacitaci칩n, tanto para desarrollar las capacidades actuales como para cubrir brechas de conocimiento en el equipo.", responsable: "Mariel Deluca", estado: "No iniciada", comentarios: "" },
            { nombre: "Relevar desarrollos existentes en las distintas instancias de los clientes con el objetivo de poder hacer un paquete vendible a otros clientes, como tambi칠n nuevos desarrollos que tengan dicho fin.", responsable: "Manuel Cervantes", estado: "No iniciada", comentarios: "" },
            { nombre: "Crear un espacio compartido donde todo el equipo pueda aportar y registrar distintas ideas e iniciativas que detecten, para posteriormente analizarlas y evaluar su viabilidad de presentarlas a los clientes.", responsable: "Irene Mendez", estado: "No iniciada", comentarios: "" },
            { nombre: "Implementaci칩n de una oficina de gesti칩n de proyectos con procesos estandarizados, documentaci칩n, seguimiento, control de proyectos y encuesta de satisfacci칩n", responsable: "Mariel Deluca", estado: "No iniciada", comentarios: "" }
        ];

        // Estados Disponibles
        const estados = ["No iniciada", "En Desarrollo", "Descartada", "Finalizada"];

        // Referencias a Elementos del DOM
        const filtroResponsable = document.getElementById("filtro-responsable");
        const filtroEstado = document.getElementById("filtro-estado");
        const tbody = document.getElementById("tabla-cuerpo");
        const btnAgregar = document.getElementById("btn-agregar");
        const btnExportar = document.getElementById("btn-exportar");

        // Referencias al Modal y sus Elementos
        const modal = document.getElementById("miModal");
        const spanCerrar = document.getElementsByClassName("close")[0];
        const modalTitulo = document.getElementById("modal-titulo");
        const modalInput = document.getElementById("modal-input");
        const modalTextarea = document.getElementById("modal-textarea");
        const btnGuardarCambio = document.getElementById("guardar-cambio");

        // Variables para Guardar el Estado Actual del Modal
        let filaActual = null;
        let campoActual = null;

        // Funci칩n para Cargar los Filtros de Responsables y Estados
        function cargarFiltros() {
            // Cargar Filtro de Responsables
            filtroResponsable.innerHTML = '<option value="Todos">Todos</option>';
            const responsablesUnicos = [...new Set(iniciativas.map(i => i.responsable))];
            responsablesUnicos.forEach(responsable => {
                if (responsable !== "Seleccione") { // Evitar agregar "Seleccione" como responsable
                    const option = document.createElement("option");
                    option.value = responsable;
                    option.textContent = responsable;
                    filtroResponsable.appendChild(option);
                }
            });

            // Cargar Filtro de Estados
            filtroEstado.innerHTML = '<option value="Todos">Todos</option>';
            estados.forEach(estado => {
                const option = document.createElement("option");
                option.value = estado;
                option.textContent = estado;
                filtroEstado.appendChild(option);
            });
        }

        // Funci칩n para Renderizar la Tabla de Iniciativas
        function renderTabla() {
            tbody.innerHTML = "";
            const filtroResp = filtroResponsable.value;
            const filtroEst = filtroEstado.value;

            iniciativas.forEach((iniciativa, index) => {
                // Verificar si la iniciativa cumple con los filtros seleccionados
                if ((filtroResp === "Todos" || filtroResp === iniciativa.responsable) &&
                    (filtroEst === "Todos" || filtroEst === iniciativa.estado)) {
                        const tr = document.createElement("tr");
                        
                        // Asignar clase seg칰n el estado para aplicar color de fondo
                        switch (iniciativa.estado) {
                            case "Finalizada":
                                tr.classList.add("finalizada");
                                break;
                            case "En Desarrollo":
                                tr.classList.add("en-desarrollo");
                                break;
                            case "No iniciada":
                                tr.classList.add("no-iniciada");
                                break;
                            case "Descartada":
                                tr.classList.add("descartada");
                                break;
                            default:
                                break;
                        }

                        // Celda de Iniciativa - Editable mediante Modal
                        const iniciativaTd = document.createElement("td");
                        iniciativaTd.textContent = iniciativa.nombre;
                        iniciativaTd.style.cursor = "pointer";
                        iniciativaTd.addEventListener("click", () => abrirModal(index, 'nombre'));
                        tr.appendChild(iniciativaTd);
                        
                        // Celda de Responsable - Editable mediante Select Dropdown
                        const responsableTd = document.createElement("td");
                        const selectResponsable = document.createElement("select");
                        const responsablesUnicos = [...new Set(iniciativas.map(i => i.responsable))];
                        responsablesUnicos.forEach(responsable => {
                            if (responsable !== "Seleccione") { // Evitar agregar "Seleccione" como responsable
                                const option = document.createElement("option");
                                option.value = responsable;
                                option.textContent = responsable;
                                if (responsable === iniciativa.responsable) {
                                    option.selected = true;
                                }
                                selectResponsable.appendChild(option);
                            }
                        });
                        // Agregar opci칩n para agregar un nuevo Responsable
                        const optionNuevo = document.createElement("option");
                        optionNuevo.value = "Nuevo";
                        optionNuevo.textContent = "A침adir Nuevo";
                        selectResponsable.appendChild(optionNuevo);

                        // Manejar el cambio en el select de Responsable
                        selectResponsable.addEventListener("change", () => {
                            if (selectResponsable.value === "Nuevo") {
                                // Abrir modal para a침adir un nuevo Responsable
                                abrirModal(index, 'responsable');
                            } else {
                                // Actualizar el Responsable de la iniciativa
                                iniciativas[index].responsable = selectResponsable.value;
                                guardarDatos();
                            }
                        });

                        responsableTd.appendChild(selectResponsable);
                        tr.appendChild(responsableTd);
                        
                        // Celda de Estado - Editable mediante Select Dropdown
                        const estadoTd = document.createElement("td");
                        const selectEstado = document.createElement("select");
                        estados.forEach(estado => {
                            const option = document.createElement("option");
                            option.value = estado;
                            option.textContent = estado;
                            if (estado === iniciativa.estado) {
                                option.selected = true;
                            }
                            selectEstado.appendChild(option);
                        });
                        selectEstado.addEventListener("change", () => {
                            iniciativas[index].estado = selectEstado.value;
                            guardarDatos();
                        });
                        estadoTd.appendChild(selectEstado);
                        tr.appendChild(estadoTd);
                        
                        // Celda de Comentarios - Editable mediante Modal
                        const comentarioTd = document.createElement("td");
                        comentarioTd.textContent = iniciativa.comentarios || "A침adir comentario";
                        comentarioTd.style.cursor = "pointer";
                        comentarioTd.addEventListener("click", () => abrirModal(index, 'comentarios'));
                        tr.appendChild(comentarioTd);
                        
                        tbody.appendChild(tr);
                }
            });
        }

        // Event Listener para Agregar Nueva Iniciativa
        btnAgregar.addEventListener("click", () => {
            const nuevaIniciativa = {
                nombre: "Nueva Iniciativa",
                responsable: "Seleccione",
                estado: "No iniciada",
                comentarios: ""
            };
            iniciativas.push(nuevaIniciativa);
            guardarDatos();
            renderTabla();
            cargarFiltros();
            // Abrir el modal para editar el responsable de la nueva iniciativa
            abrirModal(iniciativas.length - 1, 'responsable');
        });

        // Event Listener para Exportar a Excel con Colores de Filas
        btnExportar.addEventListener("click", () => {
            // Crear una nueva tabla HTML temporal con estilos inline
            let tablaHTML = `
                <table border="1">
                    <thead>
                        <tr style="background-color: #002244; color: #ffffff; font-weight: bold;">
                            <th>Iniciativas Aprobadas</th>
                            <th>Responsables</th>
                            <th>Estado de la Iniciativa</th>
                            <th>Comentarios</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            const filtroResp = filtroResponsable.value;
            const filtroEst = filtroEstado.value;

            iniciativas.forEach(iniciativa => {
                if ((filtroResp === "Todos" || filtroResp === iniciativa.responsable) &&
                    (filtroEst === "Todos" || filtroEst === iniciativa.estado)) {
                        let colorFondo = "";
                        switch (iniciativa.estado) {
                            case "Finalizada":
                                colorFondo = "#d1e7dd"; // Verde azulado claro
                                break;
                            case "En Desarrollo":
                                colorFondo = "#fff3cd"; // Amarillo claro
                                break;
                            case "No iniciada":
                                colorFondo = "#f8d7da"; // Rojo claro
                                break;
                            case "Descartada":
                                colorFondo = "#d1ecf1"; // Celeste claro
                                break;
                            default:
                                colorFondo = "#ffffff"; // Blanco
                        }

                        tablaHTML += `
                            <tr style="background-color: ${colorFondo};">
                                <td>${iniciativa.nombre}</td>
                                <td>${iniciativa.responsable}</td>
                                <td>${iniciativa.estado}</td>
                                <td>${iniciativa.comentarios}</td>
                            </tr>
                        `;
                }
            });

            tablaHTML += `
                    </tbody>
                </table>
            `;

            // Crear un Blob con el contenido HTML
            const blob = new Blob([tablaHTML], { type: "application/vnd.ms-excel" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "Iniciativas_Aprobadas_2024.xls";
            a.click();
            URL.revokeObjectURL(url);
        });

        // Funci칩n para Guardar Datos en LocalStorage y Actualizar Filtros y Tabla
        function guardarDatos() {
            localStorage.setItem("iniciativas", JSON.stringify(iniciativas));
            cargarFiltros();
            renderTabla();
        }

        // Funci칩n para Cargar Datos desde LocalStorage
        function cargarDatos() {
            const datosGuardados = localStorage.getItem("iniciativas");
            if (datosGuardados) {
                iniciativas = JSON.parse(datosGuardados);
            }
        }

        // Funci칩n para Abrir el Modal y Determinar el Campo a Editar
        function abrirModal(index, campo) {
            filaActual = index;
            campoActual = campo;
            const campoTexto = campo === 'nombre' ? 'Iniciativa' : (campo === 'comentarios' ? 'Comentarios' : 'Responsable');
            modalTitulo.textContent = `Editar ${campoTexto}`;
            if (campo === 'nombre' || campo === 'responsable') {
                // Mostrar el input de texto para 'nombre' o 'responsable'
                modalInput.value = campo === 'nombre' ? iniciativas[index].nombre : (iniciativas[index].responsable !== "Seleccione" ? iniciativas[index].responsable : "");
                modalInput.style.display = 'block';
                modalTextarea.style.display = 'none';
                // Si estamos editando 'responsable' y es "Seleccione", limpiar el valor
                if (campo === 'responsable' && iniciativas[index].responsable === "Seleccione") {
                    modalInput.value = "";
                }
            } else {
                // Mostrar el textarea para 'comentarios'
                modalTextarea.value = iniciativas[index].comentarios;
                modalTextarea.style.display = 'block';
                modalInput.style.display = 'none';
            }
            modal.style.display = "block";
        }

        // Event Listener para Cerrar el Modal al Hacer Clic en la 'X'
        spanCerrar.onclick = function() {
            modal.style.display = "none";
        }

        // Event Listener para Cerrar el Modal al Hacer Clic Fuera del Contenido del Modal
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        // Event Listener para Guardar Cambios desde el Modal
        btnGuardarCambio.addEventListener("click", () => {
            if (campoActual === 'nombre') {
                iniciativas[filaActual].nombre = modalInput.value.trim() || "Sin Nombre";
            } else if (campoActual === 'comentarios') {
                iniciativas[filaActual].comentarios = modalTextarea.value.trim();
            } else if (campoActual === 'responsable') {
                const nuevoResponsable = modalInput.value.trim();
                if (nuevoResponsable !== "") {
                    iniciativas[filaActual].responsable = nuevoResponsable;
                } else {
                    alert("El campo 'Responsable' no puede estar vac칤o.");
                    return;
                }
            }
            guardarDatos();
            modal.style.display = "none";
        });

        // Funci칩n de Inicializaci칩n de la P치gina
        function init() {
            cargarDatos();
            cargarFiltros();
            renderTabla();

            // Escuchar cambios en filtros para re-renderizar la tabla
            filtroResponsable.addEventListener("change", renderTabla);
            filtroEstado.addEventListener("change", renderTabla);
        }

        // Ejecutar la Inicializaci칩n al Cargar la P치gina
        init();
    </script>
</body>
</html>
