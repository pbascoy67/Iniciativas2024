<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciativas Aprobadas 2024</title>
    <style>
        :root {
            --color-fondo: #f0f4f8;
            --color-primario: #003366;
            --color-secundario: #ffffff;
            --color-texto: #ffffff;
            --color-texto-general: #333333;
            --color-borde: #cccccc;
            --color-hover: #e6f0fa;
            --color-header: #002244;
            --color-boton: #003366;
            --color-boton-texto: #ffffff;
            --color-finalizada: #d1e7dd;
            --color-en-desarrollo: #fff3cd;
            --color-no-iniciada: #f8d7da;
            --color-descartada: #d1ecf1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-fondo);
            margin: 0;
            padding: 20px;
            color: var(--color-texto-general);
        }

        .encabezado {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-header);
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
        }

        .encabezado h1 {
            color: var(--color-texto);
            font-size: 2em;
            margin: 0;
            text-align: center;
            width: 100%;
        }

        .encabezado img {
            height: 60px;
            position: absolute;
            right: 20px;
        }

        .filtros {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center;
            background-color: var(--color-header);
            padding: 10px 20px;
            border-radius: 8px;
        }

        .filtros div {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        label {
            font-weight: bold;
            color: var(--color-texto);
        }

        select {
            padding: 5px 10px;
            border: 1px solid var(--color-borde);
            border-radius: 4px;
            background-color: var(--color-secundario);
            transition: border 0.3s;
            color: var(--color-texto-general);
        }

        select:focus {
            border-color: var(--color-primario);
            outline: none;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: var(--color-secundario);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        th, td {
            border: 1px solid var(--color-borde);
            padding: 12px 15px;
            text-align: left;
            transition: background-color 0.3s;
            position: relative;
        }

        th {
            background-color: var(--color-header);
            color: var(--color-texto);
            position: sticky;
            top: 0;
            z-index: 2;
            font-weight: bold;
        }

        tr:nth-child(even) {
            background-color: #e6f0fa;
        }

        tr:hover {
            background-color: var(--color-hover);
        }

        tr.finalizada {
            background-color: var(--color-finalizada) !important;
        }

        tr.en-desarrollo {
            background-color: var(--color-en-desarrollo) !important;
        }

        tr.no-iniciada {
            background-color: var(--color-no-iniciada) !important;
        }

        tr.descartada {
            background-color: var(--color-descartada) !important;
        }

        input[type="text"], select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--color-borde);
            border-radius: 4px;
            box-sizing: border-box;
            transition: border 0.3s;
            background-color: var(--color-secundario);
            color: var(--color-texto-general);
            resize: vertical;
        }

        input[type="text"]:focus, select:focus, textarea:focus {
            border-color: var(--color-primario);
            outline: none;
        }

        textarea.expandable-textarea {
            min-height: 60px;
            overflow: hidden;
            transition: min-height 0.3s;
        }

        textarea.expandable-textarea:focus {
            min-height: 120px;
        }

        .btn-agregar, .btn-exportar {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
            gap: 10px;
        }

        .btn-agregar button, .btn-exportar button {
            background-color: var(--color-boton);
            color: var(--color-boton-texto);
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        .btn-agregar button:hover, .btn-exportar button:hover {
            background-color: #002244;
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            th, td {
                padding: 8px 10px;
            }

            .btn-agregar, .btn-exportar {
                flex-direction: column;
                align-items: center;
            }

            .btn-agregar button, .btn-exportar button {
                width: 100%;
            }

            .filtros {
                flex-direction: column;
                align-items: center;
            }

            .encabezado {
                flex-direction: column;
                align-items: center;
            }

            .encabezado img {
                position: static;
                margin: 10px 0 0 0;
            }

            .encabezado h1 {
                text-align: center;
            }
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--color-secundario);
            margin: 10% auto;
            padding: 20px;
            border: 1px solid var(--color-borde);
            width: 80%;
            border-radius: 8px;
            position: relative;
        }

        .close {
            color: var(--color-texto-general);
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: var(--color-primario);
            text-decoration: none;
            cursor: pointer;
        }

        .modal textarea, .modal input[type="text"] {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            margin-bottom: 20px;
            border: 1px solid var(--color-borde);
            border-radius: 4px;
            resize: vertical;
            color: var(--color-texto-general);
        }

        .modal button {
            background-color: var(--color-primario);
            color: var(--color-boton-texto);
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .modal button:hover {
            background-color: #002244;
        }
    </style>
</head>
<body>
    <div class="encabezado">
        <h1>Iniciativas Aprobadas 2024</h1>
        <img src="blatorh.png" alt="Logo de Blatorh">
    </div>
    <div class="filtros">
        <div>
            <label for="filtro-responsable">Filtrar por Responsable:</label>
            <select id="filtro-responsable">
                <option value="Todos">Todos</option>
            </select>
        </div>
        
        <div>
            <label for="filtro-estado">Filtrar por Estado:</label>
            <select id="filtro-estado">
                <option value="Todos">Todos</option>
            </select>
        </div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th style="width: 35%">Iniciativas Aprobadas</th>
                <th style="width: 20%">Responsables</th>
                <th style="width: 20%">Estado de la Iniciativa</th>
                <th style="width: 20%">Comentarios</th>
            </tr>
        </thead>
        <tbody id="tabla-cuerpo">
        </tbody>
    </table>

    <div class="btn-agregar btn-exportar">
        <button id="btn-exportar">ðŸ“¥ Descargar a Excel</button>
        <button id="btn-agregar">+ Agregar Iniciativa</button>
    </div>

    <div id="miModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modal-titulo">Editar</h2>
            <input type="text" id="modal-input" />
            <textarea id="modal-textarea" rows="4"></textarea>
            <button id="guardar-cambio">Guardar</button>
        </div>
    </div>

    <script>
        let iniciativas = [
            { nombre: "Generar un set de reportes en nuestra base de datos", responsable: "Anthony Rivero", estado: "No iniciada", comentarios: "" },
            { nombre: "ImplementaciÃ³n de herramienta de monitoreo", responsable: "Anthony Rivero", estado: "En Desarrollo", comentarios: "" },
            { nombre: "Desarrollo de funcionalidades avanzadas", responsable: "Ariel Di Prinzio", estado: "Finalizada", comentarios: "" },
            { nombre: "ImplementaciÃ³n de Payroll Control Center", responsable: "Pablo Bascoy", estado: "No iniciada", comentarios: "" },
            { nombre: "ElecciÃ³n de herramienta y propuesta de procesos", responsable: "Pablo Bascoy", estado: "Descartada", comentarios: "" }
        ];

        const estados = ["No iniciada", "En Desarrollo", "Descartada", "Finalizada"];

        const filtroResponsable = document.getElementById("filtro-responsable");
        const filtroEstado = document.getElementById("filtro-estado");
        const tbody = document.getElementById("tabla-cuerpo");
        const btnAgregar = document.getElementById("btn-agregar");
        const btnExportar = document.getElementById("btn-exportar");

        const modal = document.getElementById("miModal");
        const spanCerrar = document.getElementsByClassName("close")[0];
        const modalTitulo = document.getElementById("modal-titulo");
        const modalInput = document.getElementById("modal-input");
        const modalTextarea = document.getElementById("modal-textarea");
        const btnGuardarCambio = document.getElementById("guardar-cambio");

        let filaActual = null;
        let campoActual = null;

        function cargarFiltros() {
            filtroResponsable.innerHTML = '<option value="Todos">Todos</option>';
            const responsablesUnicos = [...new Set(iniciativas.map(i => i.responsable))];
            responsablesUnicos.forEach(responsable => {
                const option = document.createElement("option");
                option.value = responsable;
                option.textContent = responsable;
                filtroResponsable.appendChild(option);
            });

            filtroEstado.innerHTML = '<option value="Todos">Todos</option>';
            estados.forEach(estado => {
                const option = document.createElement("option");
                option.value = estado;
                option.textContent = estado;
                filtroEstado.appendChild(option);
            });
        }

        function renderTabla() {
            tbody.innerHTML = "";
            const filtroResp = filtroResponsable.value;
            const filtroEst = filtroEstado.value;

            iniciativas.forEach((iniciativa, index) => {
                if ((filtroResp === "Todos" || filtroResp === iniciativa.responsable) &&
                    (filtroEst === "Todos" || filtroEst === iniciativa.estado)) {
                        const tr = document.createElement("tr");
                        
                        switch (iniciativa.estado) {
                            case "Finalizada":
                                tr.classList.add("finalizada");
                                break;
                            case "En Desarrollo":
                                tr.classList.add("en-desarrollo");
                                break;
                            case "No iniciada":
                                tr.classList.add("no-iniciada");
                                break;
                            case "Descartada":
                                tr.classList.add("descartada");
                                break;
                            default:
                                break;
                        }

                        const iniciativaTd = document.createElement("td");
                        iniciativaTd.textContent = iniciativa.nombre;
                        iniciativaTd.style.cursor = "pointer";
                        iniciativaTd.addEventListener("click", () => abrirModal(index, 'nombre'));
                        tr.appendChild(iniciativaTd);
                        
                        const responsableTd = document.createElement("td");
                        const selectResponsable = document.createElement("select");
                        const responsablesUnicos = [...new Set(iniciativas.map(i => i.responsable))];
                        responsablesUnicos.forEach(responsable => {
                            const option = document.createElement("option");
                            option.value = responsable;
                            option.textContent = responsable;
                            if (responsable === iniciativa.responsable) {
                                option.selected = true;
                            }
                            selectResponsable.appendChild(option);
                        });
                        const optionNuevo = document.createElement("option");
                        optionNuevo.value = "Nuevo";
                        optionNuevo.textContent = "AÃ±adir Nuevo";
                        selectResponsable.appendChild(optionNuevo);

                        selectResponsable.addEventListener("change", () => {
                            if (selectResponsable.value === "Nuevo") {
                                abrirModal(index, 'responsable');
                            } else {
                                iniciativas[index].responsable = selectResponsable.value;
                                guardarDatos();
                            }
                        });

                        responsableTd.appendChild(selectResponsable);
                        tr.appendChild(responsableTd);
                        
                        const estadoTd = document.createElement("td");
                        const selectEstado = document.createElement("select");
                        estados.forEach(estado => {
                            const option = document.createElement("option");
                            option.value = estado;
                            option.textContent = estado;
                            if (estado === iniciativa.estado) {
                                option.selected = true;
                            }
                            selectEstado.appendChild(option);
                        });
                        selectEstado.addEventListener("change", () => {
                            iniciativas[index].estado = selectEstado.value;
                            guardarDatos();
                        });
                        estadoTd.appendChild(selectEstado);
                        tr.appendChild(estadoTd);
                        
                        const comentarioTd = document.createElement("td");
                        comentarioTd.textContent = iniciativa.comentarios || "AÃ±adir comentario";
                        comentarioTd.style.cursor = "pointer";
                        comentarioTd.addEventListener("click", () => abrirModal(index, 'comentarios'));
                        tr.appendChild(comentarioTd);
                        
                        tbody.appendChild(tr);
                }
            });
        }

        btnAgregar.addEventListener("click", () => {
            const nuevaIniciativa = {
                nombre: "Nueva Iniciativa",
                responsable: "Nuevo",
                estado: "No iniciada",
                comentarios: ""
            };
            iniciativas.push(nuevaIniciativa);
            guardarDatos();
            renderTabla();
            cargarFiltros();
        });

        btnExportar.addEventListener("click", () => {
            let tablaHTML = `
                <table border="1">
                    <thead>
                        <tr style="background-color: #002244; color: #ffffff; font-weight: bold;">
                            <th>Iniciativas Aprobadas</th>
                            <th>Responsables</th>
                            <th>Estado de la Iniciativa</th>
                            <th>Comentarios</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            const filtroResp = filtroResponsable.value;
            const filtroEst = filtroEstado.value;

            iniciativas.forEach(iniciativa => {
                if ((filtroResp === "Todos" || filtroResp === iniciativa.responsable) &&
                    (filtroEst === "Todos" || filtroEst === iniciativa.estado)) {
                        let colorFondo = "";
                        switch (iniciativa.estado) {
                            case "Finalizada":
                                colorFondo = "#d1e7dd";
                                break;
                            case "En Desarrollo":
                                colorFondo = "#fff3cd";
                                break;
                            case "No iniciada":
                                colorFondo = "#f8d7da";
                                break;
                            case "Descartada":
                                colorFondo = "#d1ecf1";
                                break;
                            default:
                                colorFondo = "#ffffff";
                        }

                        tablaHTML += `
                            <tr style="background-color: ${colorFondo};">
                                <td>${iniciativa.nombre}</td>
                                <td>${iniciativa.responsable}</td>
                                <td>${iniciativa.estado}</td>
                                <td>${iniciativa.comentarios}</td>
                            </tr>
                        `;
                }
            });

            tablaHTML += `
                    </tbody>
                </table>
            `;

            const blob = new Blob([tablaHTML], { type: "application/vnd.ms-excel" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "Iniciativas_Aprobadas_2024.xls";
            a.click();
            URL.revokeObjectURL(url);
        });

        function guardarDatos() {
            localStorage.setItem("iniciativas", JSON.stringify(iniciativas));
            renderTabla();
        }

        function cargarDatos() {
            const datosGuardados = localStorage.getItem("iniciativas");
            if (datosGuardados) {
                iniciativas = JSON.parse(datosGuardados);
            }
        }

        function abrirModal(index, campo) {
            filaActual = index;
            campoActual = campo;
            const campoTexto = campo === 'nombre' ? 'Iniciativa' : (campo === 'comentarios' ? 'Comentarios' : 'Responsable');
            modalTitulo.textContent = `Editar ${campoTexto}`;
            if (campo === 'nombre' || campo === 'responsable') {
                modalInput.value = campo === 'nombre' ? iniciativas[index].nombre : iniciativas[index].responsable;
                modalInput.style.display = 'block';
                modalTextarea.style.display = 'none';
            } else {
                modalTextarea.value = iniciativas[index].comentarios;
                modalTextarea.style.display = 'block';
                modalInput.style.display = 'none';
            }
            modal.style.display = "block";
        }

        spanCerrar.onclick = function() {
            modal.style.display = "none";
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }

        btnGuardarCambio.addEventListener("click", () => {
            if (campoActual === 'nombre') {
                iniciativas[filaActual].nombre = modalInput.value.trim() || "Sin Nombre";
            } else if (campoActual === 'comentarios') {
                iniciativas[filaActual].comentarios = modalTextarea.value.trim();
            } else if (campoActual === 'responsable') {
                const nuevoResponsable = modalInput.value.trim();
                if (nuevoResponsable !== "") {
                    iniciativas[filaActual].responsable = nuevoResponsable;
                    guardarDatos();
                }
            }
            modal.style.display = "none";
        });

        function init() {
            cargarDatos();
            cargarFiltros();
            renderTabla();

            filtroResponsable.addEventListener("change", renderTabla);
            filtroEstado.addEventListener("change", renderTabla);
        }

        init();
    </script>
</body>
</html>
